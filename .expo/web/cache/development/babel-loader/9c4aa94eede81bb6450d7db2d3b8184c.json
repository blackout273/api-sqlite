{"ast":null,"code":"import db from \"./sqliteDatabase.js\";\ndb.transaction(function (tx) {\n  tx.executeSql(\"CREATE TABLE dadosUsuarios ( id INTEGER PRIMARY KEY AUTOINCREMENT UNIQUE NOT NULL, email VARCHAR (100), senha VARCHAR (64), usuario VARCHAR (64), createdAt DATETIME DEFAULT (CURRENT_TIMESTAMP) );\");\n});\n\nvar create = function create(obj) {\n  return new Promise(function (resolve, reject) {\n    db.transaction(function (tx) {\n      tx.executeSql(\"INSERT INTO dadosUsuarios (email, senha, usuario) values (?, ?, ?);\", [obj.email, obj.senha, obj.usuario], function (_, _ref) {\n        var rowsAffected = _ref.rowsAffected,\n            insertId = _ref.insertId;\n        if (rowsAffected > 0) resolve(insertId);else reject(\"Error inserting obj: \" + JSON.stringify(obj));\n      }, function (_, error) {\n        return reject(error);\n      });\n    });\n  });\n};\n\nvar update = function update(id, obj) {\n  return new Promise(function (resolve, reject) {\n    db.transaction(function (tx) {\n      tx.executeSql(\"UPDATE cars SET brand=?, model=?, hp=? WHERE id=?;\", [obj.brand, obj.model, obj.hp, id], function (_, _ref2) {\n        var rowsAffected = _ref2.rowsAffected;\n        if (rowsAffected > 0) resolve(rowsAffected);else reject(\"Error updating obj: id=\" + id);\n      }, function (_, error) {\n        return reject(error);\n      });\n    });\n  });\n};\n\nexport var find = function find(email) {\n  console.log(\"promise\");\n  return new Promise(function (resolve, reject) {\n    console.log(\"transact\");\n    db.transaction(function (tx) {\n      tx.executeSql(\"SELECT * FROM dadosUsuarios WHERE email=?;\", [email], function (_, _ref3) {\n        var rows = _ref3.rows;\n        console.log(rows._array[0]);\n\n        if (rows.length > 0) {\n          resolve(rows._array[0]);\n        } else {\n          reject(\"Obj not found: email=\" + email);\n        }\n\n        ;\n      }, function (_, error) {\n        return reject(error);\n      });\n    });\n  });\n};\n\nvar findByBrand = function findByBrand(brand) {\n  return new Promise(function (resolve, reject) {\n    db.transaction(function (tx) {\n      tx.executeSql(\"SELECT * FROM cars WHERE brand LIKE ?;\", [brand], function (_, _ref4) {\n        var rows = _ref4.rows;\n        if (rows.length > 0) resolve(rows._array);else reject(\"Obj not found: brand=\" + brand);\n      }, function (_, error) {\n        return reject(error);\n      });\n    });\n  });\n};\n\nvar all = function all() {\n  var usersList = [];\n  return new Promise(function (resolve, reject) {\n    db.transaction(function (tx) {\n      tx.executeSql(\"SELECT * FROM dadosUsuarios;\", [], function (_, _ref5) {\n        var rows = _ref5.rows;\n\n        for (var i = 0; i < rows.length; i++) {\n          usersList.push(rows[i].email);\n        }\n\n        resolve(usersList);\n      }, function (_, error) {\n        return reject(error);\n      });\n    });\n  });\n};\n\nvar remove = function remove(id) {\n  return new Promise(function (resolve, reject) {\n    db.transaction(function (tx) {\n      tx.executeSql(\"DELETE FROM cars WHERE id=?;\", [id], function (_, _ref6) {\n        var rowsAffected = _ref6.rowsAffected;\n        resolve(rowsAffected);\n      }, function (_, error) {\n        return reject(error);\n      });\n    });\n  });\n};\n\nexport default {\n  create: create,\n  update: update,\n  find: find,\n  findByBrand: findByBrand,\n  all: all,\n  remove: remove\n};","map":{"version":3,"names":["db","transaction","tx","executeSql","create","obj","Promise","resolve","reject","email","senha","usuario","_","rowsAffected","insertId","JSON","stringify","error","update","id","brand","model","hp","find","console","log","rows","_array","length","findByBrand","all","usersList","i","push","remove"],"sources":["C:/Users/Danillo/Desktop/documentosEstacio/Programação para dispositivos moveis/crud/src/functions/database/usuarios.js"],"sourcesContent":["import db from \"./sqliteDatabase.js\";\r\n\r\n/**\r\n * INICIALIZAÇÃO DA TABELA\r\n * - Executa sempre, mas só cria a tabela caso não exista (primeira execução)\r\n */\r\ndb.transaction((tx) => {\r\n  //<<<<<<<<<<<<<<<<<<<<<<<< USE ISSO APENAS DURANTE OS TESTES!!! >>>>>>>>>>>>>>>>>>>>>>>\r\n  //tx.executeSql(\"DROP TABLE cars;\");\r\n  //<<<<<<<<<<<<<<<<<<<<<<<< USE ISSO APENAS DURANTE OS TESTES!!! >>>>>>>>>>>>>>>>>>>>>>>\r\n\r\n  tx.executeSql(\r\n    \"CREATE TABLE dadosUsuarios ( id INTEGER PRIMARY KEY AUTOINCREMENT UNIQUE NOT NULL, email VARCHAR (100), senha VARCHAR (64), usuario VARCHAR (64), createdAt DATETIME DEFAULT (CURRENT_TIMESTAMP) );\"\r\n  );\r\n});\r\n\r\n/**\r\n * CRIAÇÃO DE UM NOVO REGISTRO\r\n * - Recebe um objeto;\r\n * - Retorna uma Promise:\r\n *  - O resultado da Promise é o ID do registro (criado por AUTOINCREMENT)\r\n *  - Pode retornar erro (reject) caso exista erro no SQL ou nos parâmetros.\r\n */\r\nconst create = (obj) => {\r\n  return new Promise((resolve, reject) => {\r\n    db.transaction((tx) => {\r\n      //comando SQL modificável\r\n      tx.executeSql(\r\n        \"INSERT INTO dadosUsuarios (email, senha, usuario) values (?, ?, ?);\",\r\n        [obj.email, obj.senha, obj.usuario],\r\n        //-----------------------\r\n        (_, { rowsAffected, insertId }) => {\r\n          if (rowsAffected > 0) resolve(insertId);\r\n          else reject(\"Error inserting obj: \" + JSON.stringify(obj)); // insert falhou\r\n        },\r\n        (_, error) => reject(error) // erro interno em tx.executeSql\r\n      );\r\n    });\r\n  });\r\n};\r\n\r\n/**\r\n * ATUALIZA UM REGISTRO JÁ EXISTENTE\r\n * - Recebe o ID do registro e um OBJETO com valores atualizados;\r\n * - Retorna uma Promise:\r\n *  - O resultado da Promise é a quantidade de registros atualizados;\r\n *  - Pode retornar erro (reject) caso o ID não exista ou então caso ocorra erro no SQL.\r\n */\r\nconst update = (id, obj) => {\r\n  return new Promise((resolve, reject) => {\r\n    db.transaction((tx) => {\r\n      //comando SQL modificável\r\n      tx.executeSql(\r\n        \"UPDATE cars SET brand=?, model=?, hp=? WHERE id=?;\",\r\n        [obj.brand, obj.model, obj.hp, id],\r\n        //-----------------------\r\n        (_, { rowsAffected }) => {\r\n          if (rowsAffected > 0) resolve(rowsAffected);\r\n          else reject(\"Error updating obj: id=\" + id); // nenhum registro alterado\r\n        },\r\n        (_, error) => reject(error) // erro interno em tx.executeSql\r\n      );\r\n    });\r\n  });\r\n};\r\n\r\n/**\r\n * BUSCA UM REGISTRO POR MEIO DO ID\r\n * - Recebe o ID do registro;\r\n * - Retorna uma Promise:\r\n *  - O resultado da Promise é o objeto (caso exista);\r\n *  - Pode retornar erro (reject) caso o ID não exista ou então caso ocorra erro no SQL.\r\n */\r\nexport const find =  (email) => {\r\n    console.log(\"promise\")\r\n    return  new Promise((resolve, reject) => {\r\n        console.log(\"transact\")\r\n        db.transaction((tx) => {\r\n      //comando SQL modificável\r\n      tx.executeSql(\r\n        \"SELECT * FROM dadosUsuarios WHERE email=?;\",\r\n        [email],\r\n        //-----------------------\r\n        (_, { rows }) => {\r\n            console.log(rows._array[0])\r\n          if (rows.length > 0) {\r\n            resolve(rows._array[0])\r\n        }\r\n          else {\r\n            reject(\"Obj not found: email=\" + email)}; // nenhum registro encontrado\r\n        },\r\n        (_, error) => reject(error) // erro interno em tx.executeSql\r\n      );\r\n    });\r\n  });\r\n};\r\n\r\n/**\r\n * BUSCA UM REGISTRO POR MEIO DA MARCA (brand)\r\n * - Recebe a marca do carro;\r\n * - Retorna uma Promise:\r\n *  - O resultado da Promise é um array com os objetos encontrados;\r\n *  - Pode retornar erro (reject) caso o ID não exista ou então caso ocorra erro no SQL;\r\n *  - Pode retornar um array vazio caso nenhum objeto seja encontrado.\r\n */\r\nconst findByBrand = (brand) => {\r\n  return new Promise((resolve, reject) => {\r\n    db.transaction((tx) => {\r\n      //comando SQL modificável\r\n      tx.executeSql(\r\n        \"SELECT * FROM cars WHERE brand LIKE ?;\",\r\n        [brand],\r\n        //-----------------------\r\n        (_, { rows }) => {\r\n          if (rows.length > 0) resolve(rows._array);\r\n          else reject(\"Obj not found: brand=\" + brand); // nenhum registro encontrado\r\n        },\r\n        (_, error) => reject(error) // erro interno em tx.executeSql\r\n      );\r\n    });\r\n  });\r\n};\r\n\r\n/**\r\n * BUSCA TODOS OS REGISTROS DE UMA DETERMINADA TABELA\r\n * - Não recebe parâmetros;\r\n * - Retorna uma Promise:\r\n *  - O resultado da Promise é uma lista (Array) de objetos;\r\n *  - Pode retornar erro (reject) caso o ID não exista ou então caso ocorra erro no SQL;\r\n *  - Pode retornar um array vazio caso não existam registros.\r\n */\r\nconst all = () => {\r\n    const usersList=[]\r\n  return new Promise((resolve, reject) => {\r\n    db.transaction((tx) => {\r\n      //comando SQL modificável\r\n      tx.executeSql(\r\n        \"SELECT * FROM dadosUsuarios;\",\r\n        [],\r\n        //-----------------------\r\n        (_, { rows }) =>{\r\n            for (let i=0; i<rows.length; i++){\r\n                usersList.push(rows[i].email)\r\n            }\r\n           \r\n            resolve(usersList)},\r\n        (_, error) => reject(error) // erro interno em tx.executeSql\r\n      );\r\n    });\r\n  });\r\n};\r\n\r\n/**\r\n * REMOVE UM REGISTRO POR MEIO DO ID\r\n * - Recebe o ID do registro;\r\n * - Retorna uma Promise:\r\n *  - O resultado da Promise a quantidade de registros removidos (zero indica que nada foi removido);\r\n *  - Pode retornar erro (reject) caso o ID não exista ou então caso ocorra erro no SQL.\r\n */\r\nconst remove = (id) => {\r\n  return new Promise((resolve, reject) => {\r\n    db.transaction((tx) => {\r\n      //comando SQL modificável\r\n      tx.executeSql(\r\n        \"DELETE FROM cars WHERE id=?;\",\r\n        [id],\r\n        //-----------------------\r\n        (_, { rowsAffected }) => {\r\n          resolve(rowsAffected);\r\n        },\r\n        (_, error) => reject(error) // erro interno em tx.executeSql\r\n      );\r\n    });\r\n  });\r\n};\r\n\r\nexport default {\r\n  create,\r\n  update,\r\n  find,\r\n  findByBrand,\r\n  all,\r\n  remove,\r\n};"],"mappings":"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"},"metadata":{},"sourceType":"module"}